# APP URL-SHORTENER

## App for shortening URL links

### Simple analogue of _Google URL Shortener_.

- Works with local MongoDB database
- Written in vanilla JavaScript
- Uses Express framework and Mongoose library

---

## НЕМНОГО ТЕОРИИ

#### ЧТО ТАКОЕ MONGODB

https://metanit.com/nosql/mongodb/1.1.php

MongoDB — документоориентированная система управления базами данных, не требующая описания схемы таблиц. Считается одним из классических примеров NoSQL-систем, использует JSON-подобные документы и схему базы данных

MongoDB реализует новый подход к построению баз данных, где нет таблиц, схем, запросов SQL, внешних ключей и многих других вещей, которые присущи объектно-реляционным базам данных

В отличие от реляционных баз данных MongoDB предлагает ДОКУМЕНТО-ОРИЕНТИРОВАННУЮ МОДЕЛЬ ДАННЫХ, благодаря чему MongoDB работает быстрее, обладает лучшей масштабируемостью, ее легче использовать.

Если реляционные базы данных хранят строки, то MongoDB хранит ДОКУМЕНТЫ. В отличие от строк документы могут хранить сложную по структуре информацию. Документ можно представить как хранилище ключей и значений.

Если в традиционном мире SQL есть таблицы, то в мире MongoDB есть КОЛЛЕКЦИИ. И если в реляционных БД
таблицы хранят однотипные жестко структурированные объекты, то в коллекции могут содержать самые
разные объекты, имеющие различную структуру и различный набор свойств.

Система хранения данных в MongoDB представляет НАБОР РЕПЛИК. В этом наборе есть основной узел, а также может быть набор вторичных узлов. Все вторичные узлы сохраняют целостность и автоматически обновляются вместе с обновлением главного узла. И если основной узел по каким-то причинам выходит из строя, то один из вторичных узлов становится главным.

В отличие от реляционных СУБД MongoDB позволяет сохранять различные документы с различным набором данных, однако при этом размер документа ограничивается 16 мб. Но MongoDB предлагает решение - специальную технологию GridFS, которая позволяет хранить данные по размеру больше, чем 16 мб.

Система GridFS состоит из двух коллекций. В первой коллекции, которая называется files, хранятся имена файлов, а также их метаданные, например, размер. А в другой коллекции, которая называется chunks, в виде небольших сегментов хранятся данные файлов, обычно сегментами по 256 кб.

#### УСТАНОВКА

Для установки MongoDB загрузим один распространяемых пакетов с официального сайта https://www.mongodb.com/download-center/community.

```js
C:\Program Files\MongoDB\Server\4.4\data\ - data directory C:\Program
Files\MongoDB\Server\4.4\log\ - log directiry
```

_MONGOD_: сервер баз данных MongoDB. Он обрабатывает запросы, управляет форматом данных и выполняет различные операции в фоновом режиме по управлению базами данных

_MONGOS_: служба маршрутизации MongoDB, которая помогает обрабатывать запросы и определять местоположение данных в кластере MongoDB

После установки надо создать на жестком диске каталог, в котором будут находиться базы данных MongoDB.

В ОС Windows по умолчанию MongoDB хранит базы данных по пути C:\data\db,
поэтому, если вы используете Windows, вам надо создать соответствующий каталог.

Если же возникла необходимость использовать какой-то другой путь к файлам, то его можно передать при запуске MongoDB во флаге --dbpath.

#### ПОДКЛЮЧЕНИЕ К СЕРВЕРУ MONGODB

После установки Mongo создался каталог C:\data\db.
Если его нет, то нужно создать его вручную.
Каталог нужен для хранения БД.

Теперь можно запустить сервер MongoDB.
Нужно перейти в консоль windows, перейти в каталог C:\mongodb\bin
и выполнить команду mongod.exe

Фрагмент лога после выполнения команды C:\mongodb\bin\mongod.exe :
... MongoDB starting : pid=17848 port=27017 dbpath=C:\data\db\ 64-bit host=ASUS

Если же возникла необходимость использовать какой-то другой путь к файлам,
то его можно передать при запуске MongoDB во флаге --dbpath.

После удачного запуска сервера мы сможем производить операции через оболочку mongo.

Эта оболочка представляет файл mongo.exe, который располагается в выше рассмотренной папке установки. Запустим этот файл: C:\mongodb\bin\mongo.exe

#### ТЕСТИРУЕМ ПОДКЛЮЧЕНИЕ:

Запускаем консольный интерфейс для взаимодействия с базами данных:
C:\mongodb\bin\mongo.exe
Теперь тестируем подключение:

```js
use test
db.users.save( { name: "Tom" } )
db.users.find()
```

#### УСТАНОВКА ДРАЙВЕРОВ MONGODB

Конечно, мы можем работать и через консоль mongo, добавляя и отображая объекты в БД.
Но нам также было бы неплохо, если бы mongoDB взаимодействовала бы с нашими приложениями, написанными на PHP, C++, C# и других языках программирования. И для этой цели нам потребуются специальные драйверы

Есть драйвер и для Node.js - https://docs.mongodb.com/drivers/node/

The official MongoDB Node.js driver allows Node.js applications to connect to MongoDB and work with data. The driver features an asynchronous API which allows you to access method return values through Promises or specify callbacks to access them when communicating with MongoDB.

#### ГРАФИЧЕСКИЙ КЛИЕНТ COMPASS

Для работы с MongoDB можно использовать официальный графический клиент Compass:
https://www.mongodb.com/download-center/compass

#### MONGOOSE

https://code.tutsplus.com/ru/articles/an-introduction-to-mongoose-for-mongodb-and-nodejs--cms-29527

_Mongoose_ - это библиотека JavaScript, часто используемая в приложении Node.js с базой данных MongoDB

Mongoose - это ODM ( Object Document Mapper - объектно-документный отобразитель).
Это означает, что Mongoose позволяет вам определять объекты со строго-типизированной схемой, соответствующей документу MongoDB.

Сразу после определения схемы Mongoose дает вам возможность создать Model (модель), основанную на определенной схеме. Затем модель синхронизируется с документом MongoDB с помощью определения схемы модели

Сразу после определения схем и моделей вы можете пользоваться различными функциями Mongoose для проверки, сохранения, удаления и запроса ваших данных, используя обычные функции MongoDB

[Документация MONGOOSE по подключению:](https://mongoosejs.com/docs/connections.html)

```js
mongoose.connect('mongodb://localhost:27017/myapp', { useNewUrlParser: true })
const MyModel = mongoose.model('Test', new Schema({ name: String }))
// Works
MyModel.findOne(function (error, result) {
  ;/_ ... _/
})
```

После сохранения модели в MongoDB создается Document (документ) с теми же свойствами, что определены в схеме, на основе которой была создана модель.
Также нам становиться доступным набор методов для работы с коллекциями и документами.

Mongoose предоставляет несколько различных функций для поиска данных определенной модели. Эти функции следующие: find, findOne и findById.
